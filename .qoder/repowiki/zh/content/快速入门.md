# 快速入门

<cite>
**本文档中引用的文件**  
- [README.md](file://README.md)
- [pyproject.toml](file://pyproject.toml)
- [example/run_exp.py](file://example/run_exp.py)
- [example/corridor/acker/planner.yaml](file://example/corridor/acker/planner.yaml)
- [example/corridor/acker/env.yaml](file://example/corridor/acker/env.yaml)
</cite>

## 目录
1. [简介](#简介)
2. [项目结构概览](#项目结构概览)
3. [安装步骤](#安装步骤)
4. [运行示例](#运行示例)
5. [参数说明](#参数说明)
6. [常见问题与解决方案](#常见问题与解决方案)
7. [后续学习建议](#后续学习建议)

## 简介
NeuPAN（Neural Proximal Alternating-minimization Network）是一种端到端、实时、无需地图且易于部署的基于模型预测控制（MPC）的机器人运动规划器。它通过将障碍物点云数据直接映射为控制动作，实现在复杂未知环境中的高效安全导航。本指南旨在帮助用户快速完成NeuPAN的安装与首次运行，提供清晰的操作步骤和原理说明。

## 项目结构概览
NeuPAN项目包含以下主要目录和文件：
- `example/`：包含多个预设场景的示例配置文件和脚本。
- `neupan/`：核心代码模块，包括规划器、机器人模型和工具函数。
- `README.md`：项目说明文档，包含安装、使用和参数配置信息。
- `pyproject.toml`：项目依赖声明文件。

**Section sources**
- [README.md](file://README.md#L1-L242)

## 安装步骤
### 1. 克隆仓库
打开终端并执行以下命令以克隆NeuPAN仓库：
```bash
git clone https://github.com/hanruihua/NeuPAN
cd NeuPAN
```

### 2. 安装依赖
NeuPAN要求Python版本不低于3.10。使用以下命令安装核心依赖：
```bash
pip install -e .
```

### 3. 安装可选仿真环境（IR-SIM）
若要可视化运行效果，建议安装IR-SIM仿真环境：
```bash
pip install ir-sim
```
IR-SIM提供了丰富的机器人仿真场景，便于观察NeuPAN在不同环境下的导航表现。

**Section sources**
- [README.md](file://README.md#L50-L60)
- [pyproject.toml](file://pyproject.toml#L1-L35)

## 运行示例
### 执行示例脚本
进入`example`目录后，可通过`run_exp.py`脚本运行各种预设场景。例如，运行走廊环境中阿克曼转向机器人（acker）的导航任务：
```bash
python run_exp.py -e corridor -d acker
```
该命令将加载`corridor/acker/`目录下的`env.yaml`和`planner.yaml`配置文件，并启动仿真。

### 参数解析
- `-e corridor`：指定场景名称，对应`example/corridor`目录。
- `-d acker`：指定机器人运动学类型为阿克曼转向。
- 其他可选参数如`-a`保存动画、`-v`启用点云速度等，详见`run_exp.py`中的argparse定义。

### 示例输出说明
程序运行时会实时绘制：
- 绿色点：DUNE层提取的关键障碍点。
- 红色点：NRMP层处理的近邻障碍点。
- 蓝线：参考轨迹。
- 红线：优化后的最优轨迹。
- 黑线：初始路径。

当机器人到达目标或检测到碰撞风险时，仿真将自动终止。

**Section sources**
- [example/run_exp.py](file://example/run_exp.py#L0-L93)
- [example/corridor/acker/planner.yaml](file://example/corridor/acker/planner.yaml#L0-L41)
- [example/corridor/acker/env.yaml](file://example/corridor/acker/env.yaml#L0-L52)

## 参数说明
### 核心配置文件
NeuPAN使用YAML文件进行参数配置，主要包括以下部分：

#### mpc 配置
| 参数名 | 类型/默认值 | 说明 |
|-------|------------|------|
| `receding` | int / 10 | MPC预测步数 |
| `step_time` | float / 0.1 | 时间步长（秒） |
| `device` | str / "cpu" | 运行设备，推荐使用CPU |

#### robot 配置
| 参数名 | 类型/默认值 | 说明 |
|-------|------------|------|
| `kinematics` | str / "diff" | 机器人运动学类型：`diff`（差速驱动）或`acker`（阿克曼转向） |
| `length`, `width` | float / None | 机器人长宽尺寸 |

#### pan 配置
| 参数名 | 类型/默认值 | 说明 |
|-------|------------|------|
| `dune_checkpoint` | str / None | DUNE模型检查点路径 |
| `iter_num` | int / 2 | 迭代优化次数 |

**为何推荐使用CPU？**  
由于优化求解器cvxpy不支持GPU，因此推荐使用CPU运行NeuPAN算法。更强大的CPU（如Intel i7）有助于提高控制频率和性能。

**Section sources**
- [README.md](file://README.md#L100-L200)
- [example/corridor/acker/planner.yaml](file://example/corridor/acker/planner.yaml#L0-L41)

## 常见问题与解决方案
### Python版本不兼容
**问题**：运行时报错“requires-python >= 3.10”。  
**解决**：升级Python至3.10或更高版本。

### IR-SIM未安装
**问题**：提示`irsim`模块不存在。  
**解决**：执行`pip install ir-sim`安装仿真环境。

### 设备配置错误
**问题**：设置`device: 'cuda'`导致运行失败。  
**解决**：保持默认`device: 'cpu'`，因cvxpy目前不支持GPU加速。

### 机器人尺寸变更需重新训练
**注意**：若更改机器人尺寸或形状，必须重新训练DUNE模型，否则会影响避障效果。训练方法见`example/dune_train`目录。

**Section sources**
- [README.md](file://README.md#L200-L242)
- [pyproject.toml](file://pyproject.toml#L1-L35)

## 后续学习建议
完成快速入门后，建议进一步探索以下内容：
- 查看`example/dune_train`了解如何为自定义机器人训练DUNE模型。
- 阅读`neupan/neupan.py`理解核心规划器实现。
- 使用ROS封装[neupan_ros](https://github.com/hanruihua/neupan_ros)将NeuPAN部署到真实机器人平台。
- 调整`adjust`参数以优化特定场景下的导航行为（如更激进或保守）。

通过本指南，您已成功运行NeuPAN并理解其基本工作流程。这为深入研究和实际应用奠定了坚实基础。

**Section sources**
- [README.md](file://README.md#L200-L242)