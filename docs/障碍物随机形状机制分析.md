# éšœç¢ç‰©éšæœºå½¢çŠ¶æœºåˆ¶åˆ†æ

## ğŸ¯ æ‚¨çš„å‘ç°

æ‚¨è§‚å¯Ÿåˆ°ï¼š
> "åœ¨å¥½å‡ ä¸ªåœºæ™¯ä¸‹ï¼Œæ¯æ¬¡æˆ‘è¿›å»ï¼Œè™½ç„¶éšœç¢ç‰©çš„ä½ç½®æ²¡æœ‰å˜ï¼Œä½†æ˜¯éšœç¢ç‰©çš„å½¢çŠ¶å‘ç”Ÿå˜åŒ–äº†ï¼Œç‰¹åˆ«æ˜¯æœ‰ä¸€ä¸ªåœºæ™¯çš„éšœç¢æœ¬æ¥å°±æ˜¯ä¸è§„åˆ™çš„å½¢çŠ¶ï¼Œä»–æ¯æ¬¡éƒ½å˜"

**è¿™æ˜¯æ­£ç¡®çš„è§‚å¯Ÿï¼** IR-SIM ç¡®å®æ”¯æŒéšœç¢ç‰©å½¢çŠ¶çš„éšæœºç”Ÿæˆã€‚

---

## ğŸ” åŸå› åˆ†æ

### å…³é”®é…ç½®å‚æ•°ï¼š`random_shape: true`

åœ¨ YAML é…ç½®æ–‡ä»¶ä¸­ï¼Œå¦‚æœéšœç¢ç‰©çš„ `shape` å®šä¹‰ä¸­åŒ…å« `random_shape: true`ï¼Œé‚£ä¹ˆæ¯æ¬¡åˆ›å»ºç¯å¢ƒæ—¶ï¼Œéšœç¢ç‰©çš„å½¢çŠ¶éƒ½ä¼šé‡æ–°éšæœºç”Ÿæˆã€‚

---

## ğŸ“Š ä½¿ç”¨éšæœºå½¢çŠ¶çš„åœºæ™¯

### åœºæ™¯ 1: **non_obs/diff** ï¼ˆéå‡¸éšœç¢ç‰©åœºæ™¯ï¼‰

**æ–‡ä»¶è·¯å¾„**: `example/non_obs/diff/env.yaml`

<augment_code_snippet path="example/non_obs/diff/env.yaml" mode="EXCERPT">
````yaml
obstacle:
  - number: 11
    distribution: {name: 'manual'}
    shape:
      - {name: 'polygon', random_shape: true, center_range: [0, 0, 0, 0], avg_radius_range: [0.5, 1.0], irregularity_range: [0.9, 1.0]}
    state: [[20, 34], [31, 38], [10, 20], ...]
````
</augment_code_snippet>

**ç‰¹ç‚¹**ï¼š
- âœ… **ä½ç½®å›ºå®š**ï¼š`distribution: manual` + æ˜ç¡®çš„ `state` åˆ—è¡¨
- âœ… **å½¢çŠ¶éšæœº**ï¼š`random_shape: true`
- ğŸ² **æ¯æ¬¡è¿è¡Œå½¢çŠ¶éƒ½ä¸åŒ**

---

### åœºæ™¯ 2: **dyna_non_obs/diff** ï¼ˆåŠ¨æ€éå‡¸éšœç¢ç‰©åœºæ™¯ï¼‰

**æ–‡ä»¶è·¯å¾„**: `example/dyna_non_obs/diff/env.yaml`

<augment_code_snippet path="example/dyna_non_obs/diff/env.yaml" mode="EXCERPT">
````yaml
obstacle:
  - number: 11
    distribution: {name: 'random', range_low: [5, 15, -3.14], range_high: [45, 35, 3.14]}
    shape:
      - {name: 'polygon', vertices: [[-1, -1], [1, -1], [1, 1], [-1, 1]]}
      - {name: 'circle', radius: 1.5}
      - {name: 'circle', radius: 1.0}
      - {name: 'polygon', random_shape: true, center_range: [0, 0, 0, 0], avg_radius_range: [0.5, 1.5], irregularity_range: [0.9, 0.9]}
````
</augment_code_snippet>

**ç‰¹ç‚¹**ï¼š
- âœ… **ä½ç½®éšæœº**ï¼š`distribution: random`
- âœ… **å½¢çŠ¶æ··åˆ**ï¼šå›ºå®šå½¢çŠ¶ï¼ˆå‰ 3 ä¸ªï¼‰+ éšæœºå½¢çŠ¶ï¼ˆç¬¬ 4 ä¸ªï¼‰
- ğŸ² **æ¯æ¬¡è¿è¡Œä½ç½®å’Œéƒ¨åˆ†å½¢çŠ¶éƒ½ä¸åŒ**

---

## ğŸ¨ éšæœºå½¢çŠ¶å‚æ•°è¯¦è§£

### å‚æ•°è¯´æ˜

```yaml
shape:
  - name: 'polygon'
    random_shape: true                    # å¯ç”¨éšæœºå½¢çŠ¶ç”Ÿæˆ
    center_range: [0, 0, 0, 0]            # ä¸­å¿ƒåç§»èŒƒå›´ [x_min, y_min, x_max, y_max]
    avg_radius_range: [0.5, 1.5]          # å¹³å‡åŠå¾„èŒƒå›´ [min, max]ï¼ˆç±³ï¼‰
    irregularity_range: [0.9, 1.0]        # ä¸è§„åˆ™åº¦èŒƒå›´ [min, max]
```

### å‚æ•°å«ä¹‰

| å‚æ•° | å«ä¹‰ | å–å€¼èŒƒå›´ | æ•ˆæœ |
|------|------|---------|------|
| **random_shape** | æ˜¯å¦éšæœºç”Ÿæˆå½¢çŠ¶ | true/false | true æ—¶æ¯æ¬¡é‡æ–°ç”Ÿæˆ |
| **center_range** | ä¸­å¿ƒç‚¹åç§»èŒƒå›´ | [x_min, y_min, x_max, y_max] | ç›¸å¯¹äº state çš„åç§» |
| **avg_radius_range** | å¹³å‡åŠå¾„èŒƒå›´ | [min_radius, max_radius] | æ§åˆ¶å¤šè¾¹å½¢å¤§å° |
| **irregularity_range** | ä¸è§„åˆ™åº¦èŒƒå›´ | [0.0, 1.0] | 0.0=é«˜åº¦ä¸è§„åˆ™ï¼Œ1.0=æ­£å¤šè¾¹å½¢ |

### ä¸è§„åˆ™åº¦ï¼ˆirregularityï¼‰è¯¦è§£

```
irregularity = 1.0  â†’  æ­£å¤šè¾¹å½¢ï¼ˆæ‰€æœ‰è¾¹é•¿ç›¸ç­‰ï¼‰
                       â¬¡ æ­£å…­è¾¹å½¢

irregularity = 0.9  â†’  è½»å¾®ä¸è§„åˆ™
                       â¬¢ æ¥è¿‘æ­£å¤šè¾¹å½¢ï¼Œè¾¹é•¿ç•¥æœ‰å·®å¼‚

irregularity = 0.5  â†’  ä¸­åº¦ä¸è§„åˆ™
                       â¬Ÿ æ˜æ˜¾çš„ä¸è§„åˆ™å½¢çŠ¶

irregularity = 0.0  â†’  é«˜åº¦ä¸è§„åˆ™
                       â¬  éå¸¸ä¸è§„åˆ™çš„å¤šè¾¹å½¢
```

---

## ğŸ“ˆ éšæœºå½¢çŠ¶çš„å½±å“

### å¯¹è®­ç»ƒçš„å½±å“

#### âœ… **ä¼˜ç‚¹**

1. **å¤©ç„¶çš„ç¯å¢ƒéšæœºåŒ–**
   - æ— éœ€é¢å¤–ä»£ç ï¼Œè‡ªåŠ¨å®ç°å½¢çŠ¶å¤šæ ·æ€§
   - æ¯ä¸ª episode éƒ½æ˜¯ä¸åŒçš„éšœç¢ç‰©å½¢çŠ¶

2. **æå‡æ³›åŒ–èƒ½åŠ›**
   - æ¨¡å‹ä¸ä¼šè¿‡æ‹Ÿåˆåˆ°ç‰¹å®šå½¢çŠ¶
   - å¯¹ä¸è§„åˆ™éšœç¢ç‰©çš„é²æ£’æ€§æ›´å¼º

3. **æ›´æ¥è¿‘çœŸå®åœºæ™¯**
   - çœŸå®ç¯å¢ƒä¸­éšœç¢ç‰©å½¢çŠ¶å¤šå˜
   - æé«˜å®é™…éƒ¨ç½²çš„æˆåŠŸç‡

#### âŒ **ç¼ºç‚¹**

1. **è®­ç»ƒä¸ç¨³å®š**
   - æ¯æ¬¡è¿è¡Œç¯å¢ƒä¸åŒï¼Œéš¾ä»¥å¤ç°
   - æŸå¤±æ›²çº¿å¯èƒ½æ³¢åŠ¨è¾ƒå¤§

2. **éš¾ä»¥è°ƒè¯•**
   - æ— æ³•ç²¾ç¡®é‡ç°æŸä¸ªå¤±è´¥çš„åœºæ™¯
   - éš¾ä»¥å®šä½é—®é¢˜æ˜¯å‚æ•°é—®é¢˜è¿˜æ˜¯ç¯å¢ƒé—®é¢˜

3. **è¯„ä¼°å›°éš¾**
   - æ— æ³•åœ¨å®Œå…¨ç›¸åŒçš„ç¯å¢ƒä¸­å¯¹æ¯”ä¸åŒæ–¹æ³•
   - éœ€è¦æ›´å¤šæ¬¡å®éªŒæ‰èƒ½å¾—åˆ°å¯é ç»“è®º

---

## ğŸ”§ å¦‚ä½•æ§åˆ¶éšæœºæ€§

### æ–¹æ¡ˆ 1: å®Œå…¨å›ºå®šå½¢çŠ¶

**ä¿®æ”¹é…ç½®æ–‡ä»¶**ï¼Œå°† `random_shape: true` æ”¹ä¸ºæ‰‹åŠ¨æŒ‡å®šé¡¶ç‚¹ï¼š

```yaml
# ä¿®æ”¹å‰ï¼ˆéšæœºå½¢çŠ¶ï¼‰
shape:
  - {name: 'polygon', random_shape: true, avg_radius_range: [0.5, 1.0], irregularity_range: [0.9, 1.0]}

# ä¿®æ”¹åï¼ˆå›ºå®šå½¢çŠ¶ï¼‰
shape:
  - {name: 'polygon', vertices: [[0, 0.8], [0.7, 0.4], [0.7, -0.4], [0, -0.8], [-0.7, -0.4], [-0.7, 0.4]]}
```

**ä¼˜ç‚¹**ï¼š
- âœ… å®Œå…¨å¯å¤ç°
- âœ… ä¾¿äºè°ƒè¯•
- âœ… ä¾¿äºå¯¹æ¯”å®éªŒ

**ç¼ºç‚¹**ï¼š
- âŒ å¤±å»å½¢çŠ¶å¤šæ ·æ€§
- âŒ æ³›åŒ–èƒ½åŠ›å¯èƒ½ä¸‹é™

---

### æ–¹æ¡ˆ 2: æ§åˆ¶éšæœºç§å­ï¼ˆæ¨èï¼‰

**åœ¨ä»£ç ä¸­è®¾ç½®éšæœºç§å­**ï¼Œä½¿éšæœºå½¢çŠ¶å¯å¤ç°ï¼š

```python
import numpy as np
import random
import torch

def set_seed(seed=42):
    """è®¾ç½®æ‰€æœ‰éšæœºç§å­"""
    np.random.seed(seed)
    random.seed(seed)
    torch.manual_seed(seed)
    if torch.cuda.is_available():
        torch.cuda.manual_seed(seed)
        torch.cuda.manual_seed_all(seed)
    
    # å¦‚æœ IR-SIM ä½¿ç”¨ numpy éšæœºæ•°ç”Ÿæˆå™¨ï¼Œè¿™ä¼šå½±å“éšœç¢ç‰©å½¢çŠ¶
    print(f"âœ… éšæœºç§å­å·²è®¾ç½®ä¸º: {seed}")

# åœ¨åˆ›å»ºç¯å¢ƒå‰è°ƒç”¨
set_seed(42)
env = irsim.make("example/non_obs/diff/env.yaml")
```

**ä¼˜ç‚¹**ï¼š
- âœ… ä¿ç•™å½¢çŠ¶å¤šæ ·æ€§
- âœ… å¯å¤ç°ï¼ˆç›¸åŒç§å­ â†’ ç›¸åŒå½¢çŠ¶ï¼‰
- âœ… å¯ä»¥é€šè¿‡æ”¹å˜ç§å­æµ‹è¯•ä¸åŒå½¢çŠ¶

**ç¼ºç‚¹**ï¼š
- âš ï¸ éœ€è¦ç¡®è®¤ IR-SIM æ˜¯å¦ä½¿ç”¨ numpy éšæœºæ•°ç”Ÿæˆå™¨
- âš ï¸ å¯èƒ½éœ€è¦åœ¨æ¯æ¬¡åˆ›å»ºç¯å¢ƒå‰é‡æ–°è®¾ç½®ç§å­

---

### æ–¹æ¡ˆ 3: æ··åˆç­–ç•¥ï¼ˆæœ€ä½³å®è·µï¼‰

**è®­ç»ƒé˜¶æ®µ**ï¼šä½¿ç”¨éšæœºå½¢çŠ¶ï¼Œæå‡æ³›åŒ–èƒ½åŠ›

```python
# è®­ç»ƒæ—¶ä¸è®¾ç½®ç§å­ï¼Œè®©å½¢çŠ¶éšæœºå˜åŒ–
for epoch in range(150):
    for episode in range(10):
        env = irsim.make("example/non_obs/diff/env.yaml")  # æ¯æ¬¡å½¢çŠ¶ä¸åŒ
        # è®­ç»ƒ...
```

**è¯„ä¼°é˜¶æ®µ**ï¼šå›ºå®šç§å­ï¼Œç¡®ä¿å…¬å¹³å¯¹æ¯”

```python
# è¯„ä¼°æ—¶è®¾ç½®å›ºå®šç§å­
def evaluate(model, num_episodes=100):
    success_count = 0
    for i in range(num_episodes):
        set_seed(1000 + i)  # å›ºå®šç§å­åºåˆ—
        env = irsim.make("example/non_obs/diff/env.yaml")
        success = run_episode(env, model)
        success_count += success
    
    return success_count / num_episodes
```

---

## ğŸ“Š åœºæ™¯éšæœºæ€§æ€»ç»“

### å®Œå…¨å›ºå®šçš„åœºæ™¯

| åœºæ™¯ | ä½ç½® | å½¢çŠ¶ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| **LON** | å›ºå®š | å›ºå®š | è°ƒè¯•ã€å¯¹æ¯”å®éªŒ |
| **corridor** | å›ºå®š | å›ºå®š | åŸºå‡†æµ‹è¯• |
| **convex_obs** | å›ºå®š | å›ºå®š | å‡¸éšœç¢ç‰©æµ‹è¯• |
| **pf** | æ— éšœç¢ç‰© | - | åŠ¿åœºæ³•åŸºå‡† |
| **pf_obs** | å›ºå®š | å›ºå®š | åŠ¿åœºæ³•å¯¹æ¯” |

### éƒ¨åˆ†éšæœºçš„åœºæ™¯

| åœºæ™¯ | ä½ç½® | å½¢çŠ¶ | éšæœºæ€§æ¥æº |
|------|------|------|-----------|
| **non_obs** | å›ºå®š | **éšæœº** | `random_shape: true` |

### å®Œå…¨éšæœºçš„åœºæ™¯

| åœºæ™¯ | ä½ç½® | å½¢çŠ¶ | éšæœºæ€§æ¥æº |
|------|------|------|-----------|
| **dyna_obs** | **éšæœº** | å›ºå®š | `distribution: random` |
| **dyna_non_obs** | **éšæœº** | **éƒ¨åˆ†éšæœº** | `distribution: random` + `random_shape: true` |

---

## ğŸ¯ é’ˆå¯¹æ‚¨çš„æƒ…å†µçš„å»ºè®®

### é—®é¢˜è¯Šæ–­

æ‚¨è§‚å¯Ÿåˆ°çš„ç°è±¡ï¼š
- âœ… ä½ç½®ä¸å˜
- âœ… å½¢çŠ¶å˜åŒ–

**æœ€å¯èƒ½çš„åœºæ™¯**ï¼š`example/non_obs/diff/env.yaml`

### è§£å†³æ–¹æ¡ˆ

#### å¦‚æœæ‚¨å¸Œæœ›**å®Œå…¨å›ºå®šç¯å¢ƒ**ï¼ˆç”¨äºè°ƒè¯•ï¼‰

**é€‰é¡¹ 1**ï¼šä½¿ç”¨å›ºå®šå½¢çŠ¶çš„åœºæ™¯
```bash
# ä½¿ç”¨ LON_corridor æˆ– corridor åœºæ™¯
python example/run_exp.py --env example/LON/LON_corridor.yaml
```

**é€‰é¡¹ 2**ï¼šä¿®æ”¹ non_obs é…ç½®æ–‡ä»¶
```yaml
# å°† random_shape: true æ”¹ä¸ºå›ºå®šé¡¶ç‚¹
shape:
  - {name: 'polygon', vertices: [[0, 1], [0.9, 0.3], [0.5, -0.8], [-0.5, -0.8], [-0.9, 0.3]]}
```

**é€‰é¡¹ 3**ï¼šåœ¨ä»£ç ä¸­è®¾ç½®éšæœºç§å­
```python
import numpy as np
np.random.seed(42)  # åœ¨åˆ›å»ºç¯å¢ƒå‰
env = irsim.make("example/non_obs/diff/env.yaml")
```

---

#### å¦‚æœæ‚¨å¸Œæœ›**åˆ©ç”¨éšæœºæ€§æå‡æ³›åŒ–èƒ½åŠ›**ï¼ˆæ¨èï¼‰

**è®­ç»ƒç­–ç•¥**ï¼š
```python
# è®­ç»ƒæ—¶ï¼šè®©å½¢çŠ¶éšæœºå˜åŒ–
for epoch in range(150):
    for episode in range(10):
        # ä¸è®¾ç½®ç§å­ï¼Œæ¯æ¬¡å½¢çŠ¶ä¸åŒ
        env = irsim.make("example/non_obs/diff/env.yaml")
        train_one_episode(env, planner)

# è¯„ä¼°æ—¶ï¼šå›ºå®šç§å­ç¡®ä¿å…¬å¹³å¯¹æ¯”
def evaluate():
    np.random.seed(999)
    env = irsim.make("example/non_obs/diff/env.yaml")
    return test_performance(env, planner)
```

**ä¼˜åŠ¿**ï¼š
- è®­ç»ƒæ—¶æ¥è§¦æ›´å¤šå½¢çŠ¶å˜åŒ– â†’ æ³›åŒ–èƒ½åŠ›å¼º
- è¯„ä¼°æ—¶ç¯å¢ƒå›ºå®š â†’ ç»“æœå¯å¯¹æ¯”

---

## ğŸ”¬ å®éªŒå»ºè®®

### å®éªŒ 1: éªŒè¯éšæœºç§å­æ˜¯å¦æœ‰æ•ˆ

```python
import irsim
import numpy as np

# æµ‹è¯• 1: ç›¸åŒç§å­
np.random.seed(42)
env1 = irsim.make("example/non_obs/diff/env.yaml", display=True)
input("æŸ¥çœ‹éšœç¢ç‰©å½¢çŠ¶ï¼ŒæŒ‰å›è½¦ç»§ç»­...")
env1.end()

np.random.seed(42)
env2 = irsim.make("example/non_obs/diff/env.yaml", display=True)
input("æŸ¥çœ‹éšœç¢ç‰©å½¢çŠ¶ï¼ˆåº”è¯¥ä¸ä¸Šæ¬¡ç›¸åŒï¼‰ï¼ŒæŒ‰å›è½¦ç»§ç»­...")
env2.end()

# æµ‹è¯• 2: ä¸åŒç§å­
np.random.seed(123)
env3 = irsim.make("example/non_obs/diff/env.yaml", display=True)
input("æŸ¥çœ‹éšœç¢ç‰©å½¢çŠ¶ï¼ˆåº”è¯¥ä¸å‰ä¸¤æ¬¡ä¸åŒï¼‰ï¼ŒæŒ‰å›è½¦ç»§ç»­...")
env3.end()
```

### å®éªŒ 2: å¯¹æ¯”å›ºå®š vs éšæœºå½¢çŠ¶çš„è®­ç»ƒæ•ˆæœ

```python
# ç»„ 1: å›ºå®šå½¢çŠ¶è®­ç»ƒ
np.random.seed(42)
env_fixed = irsim.make("example/corridor/diff/env.yaml")
model_fixed = train(env_fixed, epochs=50)

# ç»„ 2: éšæœºå½¢çŠ¶è®­ç»ƒ
model_random = train_with_random_shapes("example/non_obs/diff/env.yaml", epochs=50)

# è¯„ä¼°æ³›åŒ–èƒ½åŠ›
print("å›ºå®šå½¢çŠ¶æ¨¡å‹åœ¨æ–°åœºæ™¯çš„æˆåŠŸç‡:", evaluate(model_fixed, new_scene))
print("éšæœºå½¢çŠ¶æ¨¡å‹åœ¨æ–°åœºæ™¯çš„æˆåŠŸç‡:", evaluate(model_random, new_scene))
```

---

## ğŸ“š æ€»ç»“

### æ ¸å¿ƒå‘ç°

1. **IR-SIM æ”¯æŒéšæœºå½¢çŠ¶ç”Ÿæˆ**
   - é€šè¿‡ `random_shape: true` å‚æ•°
   - æ§åˆ¶å‚æ•°ï¼š`avg_radius_range`ã€`irregularity_range`

2. **éšæœºæ€§çš„åŒåˆƒå‰‘**
   - âœ… ä¼˜ç‚¹ï¼šæå‡æ³›åŒ–èƒ½åŠ›ï¼Œæ›´æ¥è¿‘çœŸå®åœºæ™¯
   - âŒ ç¼ºç‚¹ï¼šè®­ç»ƒä¸ç¨³å®šï¼Œéš¾ä»¥è°ƒè¯•å’Œå¯¹æ¯”

3. **æ¨èç­–ç•¥**
   - è®­ç»ƒæ—¶ï¼šåˆ©ç”¨éšæœºæ€§ï¼ˆä¸è®¾ç½®ç§å­ï¼‰
   - è¯„ä¼°æ—¶ï¼šå›ºå®šç§å­ï¼ˆç¡®ä¿å…¬å¹³å¯¹æ¯”ï¼‰
   - è°ƒè¯•æ—¶ï¼šä½¿ç”¨å›ºå®šå½¢çŠ¶åœºæ™¯

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **éªŒè¯**ï¼šè¿è¡Œå®éªŒ 1ï¼Œç¡®è®¤éšæœºç§å­æ˜¯å¦èƒ½æ§åˆ¶å½¢çŠ¶
2. **é€‰æ‹©**ï¼šæ ¹æ®æ‚¨çš„ç›®æ ‡é€‰æ‹©å›ºå®š/éšæœºç­–ç•¥
3. **å®æ–½**ï¼šä¿®æ”¹è®­ç»ƒä»£ç ï¼Œå®ç°æ··åˆç­–ç•¥

---

**æ‚¨çš„è§‚å¯Ÿéå¸¸æ•é”ï¼è¿™ä¸ªéšæœºå½¢çŠ¶æœºåˆ¶æ˜¯ IR-SIM çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œåˆç†åˆ©ç”¨å¯ä»¥æ˜¾è‘—æå‡æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚**

